# 室内AGV配置快速参考指南

## 🚀 一键启动

```bash
ros2 launch autoware_launch indoor_agv.launch.xml \
  map_path:=/path/to/map \
  vehicle_model:=your_agv \
  sensor_model:=your_sensor
```

---

## ⚙️ 核心参数速查表

### 速度相关
| 参数 | 文件 | 位置 | 推荐值 |
|------|------|------|--------|
| 最大速度 | motion_velocity_planner.param.yaml | `max_velocity` | 0.8-2.0 m/s |
| 最大加速度 | motion_velocity_planner.param.yaml | `max_acceleration` | 0.3-0.5 m/s² |
| 最大减速度 | motion_velocity_planner.param.yaml | `max_deceleration` | 0.5-0.8 m/s² |
| 最大急动度 | velocity_smoother.param.yaml | `max_jerk` | 0.3-0.5 m/s³ |

### 定位相关
| 参数 | 文件 | 位置 | 推荐值 |
|------|------|------|--------|
| NDT分辨率 | ndt_scan_matcher.param.yaml | `resolution` | 0.3-0.5 m |
| NDT迭代次数 | ndt_scan_matcher.param.yaml | `max_iterations` | 20-50 |
| EKF频率 | ekf_localizer.param.yaml | `predict_frequency` | 50-100 Hz |

### 感知相关
| 参数 | 文件 | 位置 | 推荐值 |
|------|------|------|--------|
| 栅格地图范围 | occupancy_grid_map.param.yaml | `map_length` | 30-50 m |
| 栅格分辨率 | occupancy_grid_map.param.yaml | `map_resolution` | 0.1-0.2 m |
| 聚类距离 | euclidean_cluster.param.yaml | `cluster_tolerance` | 0.15-0.3 m |

### 规划相关
| 参数 | 文件 | 位置 | 推荐值 |
|------|------|------|--------|
| 规划频率 | behavior_path_planner.param.yaml | `planning_hz` | 10-20 Hz |
| 避障距离 | behavior_path_planner.param.yaml | `lateral_avoidance_distance` | 0.3-0.5 m |
| 停止距离 | behavior_velocity_planner.param.yaml | `stop_distance` | 0.8-1.5 m |

### 控制相关
| 参数 | 文件 | 位置 | 推荐值 |
|------|------|------|--------|
| 控制频率 | trajectory_follower.param.yaml | `ctrl_period` | 0.02-0.03 s |
| 前瞻距离 | lateral_controller.param.yaml | `base_lookahead_distance` | 1.5-2.5 m |
| PID-P增益 | longitudinal_controller.param.yaml | `kp` | 0.8-1.5 |
| PID-I增益 | longitudinal_controller.param.yaml | `ki` | 0.05-0.2 |
| PID-D增益 | longitudinal_controller.param.yaml | `kd` | 0.03-0.1 |

---

## 🔧 常见调整场景

### 场景1：提高/降低运行速度
```yaml
# 1. motion_velocity_planner.param.yaml
max_velocity: 1.0  # 改为目标速度

# 2. behavior_velocity_planner.param.yaml
max_velocity: 1.0

# 3. vehicle_cmd_gate.param.yaml
velocity:
  max: 1.0
```

### 场景2：定位抖动
```yaml
# ndt_scan_matcher.param.yaml
resolution: 0.4  # 减小（原来0.5）
max_iterations: 40  # 增加（原来30）

# ekf_localizer.param.yaml
proc_stddev_yaw_c: 0.003  # 减小（原来0.005）
```

### 场景3：避障不及时
```yaml
# behavior_velocity_planner.param.yaml
obstacle_stop:
  stop_distance: 1.5  # 增加（原来1.0）
  decel_distance: 5.0  # 增加（原来3.0）
```

### 场景4：转弯过冲
```yaml
# lateral_controller.param.yaml
base_lookahead_distance: 1.5  # 减小（原来2.0）
lateral_error_gain: 1.2  # 增加（原来1.0）
```

### 场景5：速度不稳定
```yaml
# longitudinal_controller.param.yaml
kp: 0.8  # 降低（原来1.0）
kd: 0.1  # 增加（原来0.05）
velocity_smoothing_window: 7  # 增加（原来5）
```

### 场景6：窄通道通行
```yaml
# behavior_path_planner.param.yaml
lateral_avoidance_distance: 0.3  # 减小（原来0.5）
min_avoidance_gap: 0.6  # 减小（原来0.8）

# behavior_velocity_planner.param.yaml
corridor_width_speed_adjustment:
  enable: true
  min_corridor_width: 1.0
```

---

## 🐛 故障速查

### 问题：定位不动
```bash
# 检查激光
ros2 topic hz /sensing/lidar/points  # 应该10-20Hz

# 检查地图
ros2 topic echo /map/pointcloud_map --once

# 检查NDT
ros2 topic echo /localization/pose_estimator/ndt_scan_matcher/debug
```

### 问题：检测不到障碍物
```bash
# 检查点云
ros2 topic echo /sensing/lidar/points --once

# 检查感知输出
ros2 topic echo /perception/object_recognition/objects

# 在RViz中可视化
rviz2
```

### 问题：车辆不动
```bash
# 检查engage状态
ros2 topic echo /vehicle/engage

# 手动engage
ros2 topic pub /vehicle/engage std_msgs/msg/Bool "{data: true}"

# 检查控制命令
ros2 topic echo /control/command/control_cmd
```

---

## 📊 性能优化

### 降低CPU占用
```yaml
# ndt_scan_matcher.param.yaml
max_iterations: 15  # 减少
resolution: 0.6  # 增大

# occupancy_grid_map.param.yaml
map_resolution: 0.2  # 增大

# behavior_path_planner.param.yaml
planning_hz: 5.0  # 降低
```

### 提高实时性
```yaml
# trajectory_follower.param.yaml
ctrl_period: 0.02  # 减小（提高频率）

# behavior_path_planner.param.yaml
planning_hz: 15.0  # 提高

# ekf_localizer.param.yaml
predict_frequency: 100.0  # 提高
```

---

## 📝 调试命令集

### 查看话题
```bash
# 定位
ros2 topic echo /localization/kinematic_state

# 感知
ros2 topic echo /perception/object_recognition/objects

# 规划
ros2 topic echo /planning/scenario_planning/trajectory

# 控制
ros2 topic echo /control/command/control_cmd
```

### 查看频率
```bash
ros2 topic hz /localization/kinematic_state
ros2 topic hz /planning/scenario_planning/trajectory
ros2 topic hz /control/command/control_cmd
```

### 查看参数
```bash
ros2 param list /localization/ekf_localizer
ros2 param get /control/trajectory_follower ctrl_period
```

### 临时修改参数
```bash
ros2 param set /control/trajectory_follower ctrl_period 0.02
ros2 param set /planning/behavior_path_planner planning_hz 15.0
```

### 记录数据
```bash
# 记录关键话题
ros2 bag record \
  /localization/kinematic_state \
  /perception/object_recognition/objects \
  /planning/scenario_planning/trajectory \
  /control/command/control_cmd
```

---

## 🎯 典型配置方案

### 方案A：仓库物流（高速，大空间）
- 最大速度：1.5 m/s
- 避障距离：0.5 m
- 停止距离：1.5 m
- 栅格分辨率：0.15 m

### 方案B：医院配送（低速，高安全）
- 最大速度：0.8 m/s
- 避障距离：0.8 m
- 停止距离：2.0 m
- 栅格分辨率：0.1 m

### 方案C：工厂车间（窄通道）
- 最大速度：1.0 m/s
- 避障距离：0.3 m
- 最小通过间隙：0.6 m
- 启用通道宽度速度调整

### 方案D：高精度对接
- 目标点容差：0.2 m
- NDT分辨率：0.3 m
- 前瞻距离：1.5 m
- PID-P增益：1.2

---

## 📞 快速联系

遇到问题？
1. 查看 [README.md](./README.md) 详细文档
2. 检查 [常见问题](#) 章节
3. 提交Issue或联系技术支持

---

**更新时间**: 2025-10-21
**版本**: v1.0.0

