# è¿‘è·ç¦»ç›®æ ‡ç‚¹è§„åˆ’é—®é¢˜åˆ†æ

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

### é—®é¢˜1: ç›®æ ‡ç‚¹è·ç¦»èµ·ç‚¹è¾ƒè¿‘çš„å½±å“

**ç­”æ¡ˆï¼šæ˜¯çš„ï¼Œä¼šæœ‰æ˜¾è‘—å½±å“ï¼**

å½“ç›®æ ‡ç‚¹è·ç¦»èµ·ç‚¹è¿‡è¿‘æ—¶ï¼Œä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š

1. **è·¯å¾„è§„åˆ’å¤±è´¥** - æ— æ³•ç”Ÿæˆæœ‰æ•ˆè·¯å¾„
2. **é€Ÿåº¦è¢«å¼ºåˆ¶ä¸º0** - ç›®æ ‡ç‚¹é™„è¿‘é€Ÿåº¦å¿…é¡»ä¸º0
3. **Goal Planneræ— æ³•æ¿€æ´»** - è·ç¦»ä¸æ»¡è¶³æœ€å°è¦æ±‚
4. **å‡é€Ÿè·ç¦»ä¸è¶³** - æ— æ³•å®‰å…¨åœè½¦

---

## ğŸ” è¯¦ç»†åˆ†æ

### 1. Goal Plannerçš„è·ç¦»æ£€æŸ¥æœºåˆ¶

#### å…³é”®ä»£ç ä½ç½®
**æ–‡ä»¶ï¼š** `goal_planner_module.cpp::isExecutionRequested()`

```cpp
// 865-873è¡Œï¼šæ£€æŸ¥åˆ°ç›®æ ‡ç‚¹çš„è·ç¦»
const double self_to_goal_arc_length =
  utils::getSignedDistance(current_pose, goal_pose, current_lanes);

const double request_length = utils::isAllowedGoalModification(route_handler)
                                ? calcModuleRequestLength()
                                : parameters_.pull_over_minimum_request_length;

if (self_to_goal_arc_length < 0.0 || self_to_goal_arc_length > request_length) {
  // å¦‚æœè·ç¦»å¤ªè¿‘æˆ–å¤ªè¿œï¼Œgoal_plannerä¸æ‰§è¡Œ
  return false;
}
```

**é‡è¦å‚æ•°ï¼š**
```yaml
# goal_planner.param.yaml
pull_over:
  minimum_request_length: 0.0  # æœ€å°è¯·æ±‚é•¿åº¦ï¼ˆé»˜è®¤0ï¼Œä½†å®é™…éœ€è¦æ›´å¤§ï¼‰
  pull_over_prepare_length: 100.0  # å‡†å¤‡åœè½¦çš„é•¿åº¦
  decide_path_distance: 10.0  # å†³å®šè·¯å¾„çš„è·ç¦»
```

---

### 2. è·ç¦»ä¸è¶³æ—¶çš„é—®é¢˜

#### A. æ— æ³•ç”ŸæˆPull Overè·¯å¾„

```cpp
// 2093-2129è¡Œï¼šæ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿè·ç¦»
bool GoalPlannerModule::hasEnoughDistance(
  const PullOverPath & pull_over_path, 
  const PathWithLaneId & long_tail_reference_path) const
{
  const Pose & current_pose = planner_data_->self_odometry->pose.pose;
  const double current_vel = planner_data_->self_odometry->twist.twist.linear.x;

  // æ£€æŸ¥1: åˆ†æ®µè·¯å¾„ä¸”å·²åœæ­¢æ—¶ï¼Œéœ€è¦é‡å¯è·ç¦»
  const bool is_separated_path = pull_over_path.partial_paths().size() > 1;
  const double distance_to_start = calcSignedArcLength(
    long_tail_reference_path.points, current_pose.position, 
    pull_over_path.start_pose().position);
  const double distance_to_restart = parameters_.decide_path_distance / 2;  // 5.0m
  const double eps_vel = 0.01;
  const bool is_stopped = std::abs(current_vel) < eps_vel;
  
  if (is_separated_path && is_stopped && distance_to_start < distance_to_restart) {
    // âŒ è·ç¦»ä¸è¶³5mï¼Œæ— æ³•é‡å¯
    return false;
  }

  // æ£€æŸ¥2: è®¡ç®—å®‰å…¨å‡é€Ÿè·ç¦»
  const auto current_to_stop_distance = calcFeasibleDecelDistance(
    planner_data_, 
    parameters_.maximum_deceleration,  // 1.0 m/sÂ²
    parameters_.maximum_jerk,          // 1.0 m/sÂ³
    0.0
  );

  const double buffer = is_stopped ? stop_distance_buffer_ : 0.0;
  if (distance_to_start + buffer < *current_to_stop_distance) {
    // âŒ è·ç¦»ä¸è¶³ï¼Œæ— æ³•å®‰å…¨å‡é€Ÿ
    return false;
  }

  return true;
}
```

**è·ç¦»è®¡ç®—ç¤ºä¾‹ï¼š**
```
å‡è®¾å½“å‰é€Ÿåº¦ = 5 m/s (18 km/h)
æœ€å¤§å‡é€Ÿåº¦ = 1.0 m/sÂ²
æœ€å¤§åŠ åŠ é€Ÿåº¦ = 1.0 m/sÂ³

éœ€è¦çš„æœ€å°å®‰å…¨åœè½¦è·ç¦» â‰ˆ 12.5m

å¦‚æœç›®æ ‡ç‚¹è·ç¦» < 12.5m â†’ è·¯å¾„è§„åˆ’å¤±è´¥ï¼
```

---

#### B. ç›®æ ‡ç‚¹é™„è¿‘é€Ÿåº¦å¿…é¡»ä¸º0

**ä»£ç ä½ç½®ï¼š** `utils.cpp::set_goal()`

```cpp
// 244-292è¡Œï¼šè®¾ç½®ç›®æ ‡ç‚¹
bool set_goal(
  const double search_radius_range, 
  const PathWithLaneId & input, 
  const Pose & goal,
  PathWithLaneId * output_ptr)
{
  // è®¡ç®—refined_goal
  PathPointWithLaneId refined_goal{};
  refined_goal.point.pose = goal;
  
  // âš ï¸ å…³é”®ï¼šç›®æ ‡ç‚¹é€Ÿåº¦å¼ºåˆ¶è®¾ä¸º0
  refined_goal.point.longitudinal_velocity_mps = 0.0;
  
  // è®¡ç®—pre_refined_goalï¼ˆç›®æ ‡ç‚¹å‰1ç±³ï¼‰
  PathPointWithLaneId pre_refined_goal{};
  constexpr double goal_to_pre_goal_distance = -1.0;
  pre_refined_goal.point.pose = 
    autoware_utils::calc_offset_pose(goal, goal_to_pre_goal_distance, 0.0, 0.0);
  
  // pre_goalçš„é€Ÿåº¦ä»è·¯å¾„æ’å€¼è·å¾—
  pre_refined_goal.point.longitudinal_velocity_mps =
    calcInterpolatedVelocity(input, closest_seg_idx_for_pre_goal);
  
  // æ„å»ºè¾“å‡ºè·¯å¾„
  // ...
}
```

**å½±å“ï¼š**
```
ç›®æ ‡ç‚¹ä½ç½®ï¼šé€Ÿåº¦ = 0 m/sï¼ˆå¼ºåˆ¶ï¼‰
ç›®æ ‡ç‚¹ -1mï¼šé€Ÿåº¦ = æ’å€¼é€Ÿåº¦ï¼ˆå¯èƒ½è¾ƒä½ï¼‰
ç›®æ ‡ç‚¹ -2mï¼šé€Ÿåº¦å¼€å§‹å‡é€Ÿ
...

å¦‚æœæ€»è·ç¦» < 10mï¼Œæ•´ä¸ªè·¯å¾„éƒ½åœ¨å‡é€ŸåŒº
â†’ å¹³å‡é€Ÿåº¦æä½
â†’ æ•ˆç‡å¾ˆå·®
```

---

### 3. é€Ÿåº¦ä¸º0çš„æƒ…å†µ

#### åœºæ™¯Aï¼šç›®æ ‡ç‚¹æœ¬èº«

```cpp
// ç›®æ ‡ç‚¹é€Ÿåº¦æ°¸è¿œæ˜¯0
refined_goal.point.longitudinal_velocity_mps = 0.0;
```

#### åœºæ™¯Bï¼šè·¯å¾„å¤ªçŸ­

```cpp
// behavior_path_planner.param.yaml
forward_path_length: 300.0  # å‘å‰è·¯å¾„é•¿åº¦

// å¦‚æœèµ·ç‚¹åˆ°ç»ˆç‚¹è·ç¦» < 10m
// è€Œforward_path_length = 300m
// ä¼šç”Ÿæˆå¾ˆå¤šå¡«å……ç‚¹ï¼Œè¿™äº›ç‚¹å¯èƒ½é€Ÿåº¦ä¸º0
```

#### åœºæ™¯Cï¼šæ— æœ‰æ•ˆè½¦é“ä¿¡æ¯

```cpp
// path_utils.cpp::getReferencePath()
// å¦‚æœè·ç¦»å¤ªçŸ­ï¼Œæ— æ³•è·å–æœ‰æ•ˆè½¦é“
// å¯èƒ½è¿”å›é›¶é€Ÿåº¦è·¯å¾„

for (auto & point : reference_path.points) {
  point.point.longitudinal_velocity_mps = 0.0;  // æ— æ•ˆè·¯å¾„
}
```

---

## ğŸ¯ è·ç¦»é˜ˆå€¼æ€»ç»“

### å…³é”®è·ç¦»å‚æ•°

| å‚æ•°åç§° | é»˜è®¤å€¼ | è¯´æ˜ | å½±å“ |
|---------|--------|------|------|
| **th_arrived_distance** | 1.0 m | åˆ¤æ–­åˆ°è¾¾ç›®æ ‡çš„è·ç¦» | < 1mè®¤ä¸ºå·²åˆ°è¾¾ |
| **decide_path_distance** | 10.0 m | å†³å®špull overè·¯å¾„çš„è·ç¦» | éœ€è¦â‰¥5mé‡å¯è·ç¦» |
| **pull_over_minimum_request_length** | 0.0 m | æœ€å°è¯·æ±‚é•¿åº¦ | å»ºè®®è®¾ä¸ºâ‰¥15m |
| **pull_over_prepare_length** | 100.0 m | pull overå‡†å¤‡é•¿åº¦ | ç†æƒ³æƒ…å†µä¸‹çš„è·ç¦» |
| **backward_path_length** | 5.0 m | å‘åè·¯å¾„é•¿åº¦ | èµ·ç‚¹å‰ç¼“å†² |
| **forward_path_length** | 300.0 m | å‘å‰è·¯å¾„é•¿åº¦ | ç»ˆç‚¹åæ‰©å±• |
| **goal_search_forward** | 40.0 m | å‘å‰æœç´¢ç›®æ ‡èŒƒå›´ | ç›®æ ‡ç‚¹æœç´¢ |
| **goal_search_backward** | 20.0 m | å‘åæœç´¢ç›®æ ‡èŒƒå›´ | ç›®æ ‡ç‚¹æœç´¢ |

### æ¨èæœ€å°è·ç¦»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åœºæ™¯                    â”‚ æœ€å°è·ç¦»    â”‚ æ¨èè·ç¦»          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä½é€Ÿï¼ˆ< 2 m/sï¼‰         â”‚ 5 m         â”‚ 10-15 m          â”‚
â”‚ ä¸­é€Ÿï¼ˆ2-5 m/sï¼‰         â”‚ 15 m        â”‚ 20-30 m          â”‚
â”‚ é«˜é€Ÿï¼ˆ> 5 m/sï¼‰         â”‚ 30 m        â”‚ 50+ m            â”‚
â”‚                         â”‚             â”‚                   â”‚
â”‚ å®¤å†…AGVï¼ˆä½é€Ÿï¼‰         â”‚ 3 m         â”‚ 5-10 m           â”‚
â”‚ å®¤å†…AGVï¼ˆæ­£å¸¸ï¼‰         â”‚ 5 m         â”‚ 10-15 m          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ­ å®¤å†…AGVé…ç½®å»ºè®®

### é…ç½®å“²å­¦

å®¤å†…AGVä¸å®¤å¤–è½¦è¾†çš„ä¸»è¦åŒºåˆ«ï¼š
1. **é€Ÿåº¦æ…¢** - é€šå¸¸ < 2 m/s (7.2 km/h)
2. **ç©ºé—´å°** - èµ°å»Šå®½åº¦æœ‰é™
3. **é¢‘ç¹åœè½¦** - ç›®æ ‡ç‚¹å¯†é›†
4. **ç²¾ç¡®å®šä½** - åˆ°è¾¾ç²¾åº¦è¦æ±‚é«˜
5. **æ— äº¤é€šè§„åˆ™** - ä¸éœ€è¦è½¦é“ä¿æŒã€æ¢é“ç­‰

---

### 1. Behavior Planner ä¸»é…ç½®

**æ–‡ä»¶ï¼š** `behavior_path_planner.param.yaml`

```yaml
/**:
  ros__parameters:
    # ========== è§„åˆ’é¢‘ç‡ ==========
    planning_hz: 10.0  # å®¤å†…AGVå¯ä»¥ä¿æŒ10Hzï¼Œæˆ–é™ä½åˆ°5HzèŠ‚çœèµ„æº
    
    # ========== è·¯å¾„é•¿åº¦é…ç½® ==========
    # âš ï¸ å…³é”®ï¼šå¤§å¹…ç¼©çŸ­è·¯å¾„é•¿åº¦
    backward_path_length: 2.0        # é»˜è®¤5.0 â†’ 2.0mï¼ˆå®¤å†…ç©ºé—´å°ï¼‰
    forward_path_length: 30.0        # é»˜è®¤300.0 â†’ 30.0mï¼ˆä¸éœ€è¦çœ‹å¤ªè¿œï¼‰
    
    # Pull Overç›¸å…³
    backward_length_buffer_for_end_of_pull_over: 2.0   # é»˜è®¤5.0 â†’ 2.0m
    backward_length_buffer_for_end_of_pull_out: 2.0    # é»˜è®¤5.0 â†’ 2.0m
    minimum_pull_over_length: 5.0                      # é»˜è®¤16.0 â†’ 5.0m
    
    # ç›®æ ‡æœç´¢åŠå¾„
    refine_goal_search_radius_range: 3.0  # é»˜è®¤7.5 â†’ 3.0mï¼ˆæé«˜ç²¾åº¦ï¼‰
    
    # ========== è½¬å‘ç¯é…ç½®ï¼ˆAGVå¯èƒ½ä¸éœ€è¦ï¼‰==========
    turn_signal_intersection_search_distance: 5.0   # é»˜è®¤30.0 â†’ 5.0m
    turn_signal_minimum_search_distance: 3.0        # é»˜è®¤10.0 â†’ 3.0m
    turn_signal_search_time: 1.0                    # é»˜è®¤3.0 â†’ 1.0s
    turn_signal_shift_length_threshold: 0.1         # é»˜è®¤0.3 â†’ 0.1m
    
    # ========== è·¯å¾„é—´éš” ==========
    input_path_interval: 0.5          # é»˜è®¤2.0 â†’ 0.5mï¼ˆæ›´å¯†é›†ï¼Œæ›´å¹³æ»‘ï¼‰
    output_path_interval: 0.5         # é»˜è®¤2.0 â†’ 0.5m
```

---

### 2. Goal Planner é…ç½®

**æ–‡ä»¶ï¼š** `goal_planner.param.yaml`

```yaml
/**:
  ros__parameters:
    goal_planner:
      # ========== åˆ°è¾¾åˆ¤æ–­ ==========
      th_arrived_distance: 0.3        # é»˜è®¤1.0 â†’ 0.3mï¼ˆAGVéœ€è¦æ›´ç²¾ç¡®ï¼‰
      th_stopped_velocity: 0.01       # ä¿æŒ0.01 m/s
      th_stopped_time: 1.0            # é»˜è®¤2.0 â†’ 1.0sï¼ˆå¿«é€Ÿå“åº”ï¼‰
      
      center_line_path_interval: 0.5  # é»˜è®¤1.0 â†’ 0.5m
      
      # ========== ç›®æ ‡æœç´¢ ==========
      goal_search:
        goal_priority: "minimum_weighted_distance"
        minimum_weighted_distance:
          lateral_weight: 20.0        # é»˜è®¤40.0 â†’ 20.0ï¼ˆé™ä½æ¨ªå‘æƒé‡ï¼‰
        
        prioritize_goals_before_objects: true
        parking_policy: "left_side"   # æˆ–æ ¹æ®AGVä¹ æƒ¯é€‰æ‹©
        
        # âš ï¸ å…³é”®ï¼šå¤§å¹…ç¼©çŸ­æœç´¢èŒƒå›´
        forward_goal_search_length: 10.0   # é»˜è®¤40.0 â†’ 10.0m
        backward_goal_search_length: 5.0   # é»˜è®¤20.0 â†’ 5.0m
        
        goal_search_interval: 0.5          # é»˜è®¤2.0 â†’ 0.5mï¼ˆæ›´å¯†é›†æœç´¢ï¼‰
        longitudinal_margin: 1.0           # é»˜è®¤3.0 â†’ 1.0m
        max_lateral_offset: 0.5            # é»˜è®¤1.0 â†’ 0.5mï¼ˆèµ°å»Šçª„ï¼‰
        lateral_offset_interval: 0.2       # é»˜è®¤0.5 â†’ 0.2m
        
        margin_from_boundary: 0.3          # é»˜è®¤0.75 â†’ 0.3m
        high_curvature_threshold: 0.2      # é»˜è®¤0.1 â†’ 0.2ï¼ˆå…è®¸æ›´å¼¯æ›²ï¼‰
      
      # ========== å ç”¨æ …æ ¼åœ°å›¾ ==========
      occupancy_grid:
        use_occupancy_grid_for_goal_search: true
        use_occupancy_grid_for_path_collision_check: true  # å®¤å†…å»ºè®®å¯ç”¨
        occupancy_grid_collision_check_margin: 0.1         # é»˜è®¤0.0 â†’ 0.1m
        theta_size: 360
        obstacle_threshold: 60
      
      # ========== éšœç¢ç‰©è¯†åˆ« ==========
      object_recognition:
        # âš ï¸ å®¤å†…AGVå¯èƒ½åªå…³å¿ƒäºº
        collision_check_soft_margins: [2.0, 1.5, 1.0, 0.5]  # ç®€åŒ–margin
        collision_check_hard_margins: [0.3]                 # é»˜è®¤0.6 â†’ 0.3m
        
        object_recognition_collision_check_max_extra_stopping_margin: 0.5  # é»˜è®¤1.0 â†’ 0.5m
        
        th_moving_object_velocity: 0.5      # é»˜è®¤1.0 â†’ 0.5 m/sï¼ˆå®¤å†…ç‰©ä½“æ…¢ï¼‰
        detection_bound_offset: 5.0         # é»˜è®¤15.0 â†’ 5.0m
        outer_road_detection_offset: 0.5    # é»˜è®¤1.0 â†’ 0.5m
      
      # ========== Pull Overé…ç½® ==========
      pull_over:
        # âš ï¸ å…³é”®ï¼šè°ƒæ•´åˆ°AGVå°ºåº¦
        minimum_request_length: 5.0         # é»˜è®¤0.0 â†’ 5.0mï¼ˆå¿…é¡»è®¾ç½®ï¼ï¼‰
        pull_over_prepare_length: 15.0      # é»˜è®¤100.0 â†’ 15.0m
        
        # é€Ÿåº¦é…ç½®
        pull_over_velocity: 0.8             # é»˜è®¤3.0 â†’ 0.8 m/sï¼ˆæ…¢é€Ÿæ¥è¿‘ï¼‰
        pull_over_minimum_velocity: 0.5     # é»˜è®¤1.38 â†’ 0.5 m/s
        
        decide_path_distance: 3.0           # é»˜è®¤10.0 â†’ 3.0m
        
        # åŠ¨åŠ›å­¦å‚æ•°ï¼ˆAGVé€šå¸¸è¾ƒå¹³ç¼“ï¼‰
        maximum_deceleration: 0.5           # é»˜è®¤1.0 â†’ 0.5 m/sÂ²
        maximum_jerk: 0.5                   # é»˜è®¤1.0 â†’ 0.5 m/sÂ³
        
        path_priority: "close_goal"         # é»˜è®¤"efficient_path" â†’ "close_goal"
        efficient_path_order: ["SHIFT"]     # å®¤å†…AGVåªç”¨ç®€å•shift
        
        lane_departure_check_expansion_margin: 0.1  # é»˜è®¤0.2 â†’ 0.1m
        
        # ========== Shift Parking ==========
        shift_parking:
          enable_shift_parking: true
          shift_sampling_num: 2             # é»˜è®¤4 â†’ 2ï¼ˆå‡å°‘è®¡ç®—ï¼‰
          maximum_lateral_jerk: 1.0         # é»˜è®¤2.0 â†’ 1.0
          minimum_lateral_jerk: 0.3         # é»˜è®¤0.5 â†’ 0.3
          deceleration_interval: 5.0        # é»˜è®¤15.0 â†’ 5.0m
          after_shift_straight_distance: 0.5  # é»˜è®¤1.0 â†’ 0.5m
        
        # ========== Parallel Parkingï¼ˆå¯é€‰ç¦ç”¨ï¼‰==========
        parallel_parking:
          max_steer_angle_margin_scale: 0.72
          forward:
            enable_arc_forward_parking: false    # å®¤å†…AGVé€šå¸¸ä¸éœ€è¦
          backward:
            enable_arc_backward_parking: false   # å®¤å†…AGVé€šå¸¸ä¸éœ€è¦
        
        # ========== Freespace Parkingï¼ˆå¯èƒ½éœ€è¦ï¼‰==========
        freespace_parking:
          enable_freespace_parking: true     # å¦‚æœéœ€è¦é¿éšœå¯¼èˆª
          freespace_parking_algorithm: "astar"
          velocity: 0.5                      # é»˜è®¤1.0 â†’ 0.5 m/s
          vehicle_shape_margin: 0.3          # é»˜è®¤1.0 â†’ 0.3mï¼ˆå‡å°marginï¼‰
          time_limit: 1500.0                 # é»˜è®¤3000.0 â†’ 1500ms
          
          search_configs:
            theta_size: 72                   # é»˜è®¤120 â†’ 72ï¼ˆå‡å°‘è®¡ç®—ï¼‰
            angle_goal_range: 10.0           # é»˜è®¤6.0 â†’ 10.0ï¼ˆæ›´å®½å®¹ï¼‰
            lateral_goal_range: 0.3          # é»˜è®¤0.5 â†’ 0.3m
            longitudinal_goal_range: 1.0     # é»˜è®¤2.0 â†’ 1.0m
      
      # ========== åœæ­¢æ¡ä»¶ ==========
      stop_condition:
        maximum_deceleration_for_stop: 0.5  # é»˜è®¤1.0 â†’ 0.5 m/sÂ²
        maximum_jerk_for_stop: 0.5          # é»˜è®¤1.0 â†’ 0.5 m/sÂ³
      
      # ========== è·¯å¾„å®‰å…¨æ£€æŸ¥ ==========
      path_safety_check:
        ego_predicted_path:
          min_velocity: 0.5                 # é»˜è®¤1.0 â†’ 0.5 m/s
          min_acceleration: 0.5             # é»˜è®¤1.0 â†’ 0.5 m/sÂ²
          max_velocity: 2.0                 # é»˜è®¤1.0 â†’ 2.0 m/sï¼ˆAGVæœ€å¤§é€Ÿåº¦ï¼‰
          time_horizon_for_front_object: 3.0  # é»˜è®¤5.0 â†’ 3.0s
          time_horizon_for_rear_object: 3.0   # é»˜è®¤5.0 â†’ 3.0s
          time_resolution: 0.5
          delay_until_departure: 0.5        # é»˜è®¤1.0 â†’ 0.5s
        
        target_filtering:
          safety_check_time_horizon: 3.0    # é»˜è®¤5.0 â†’ 3.0s
          object_check_forward_distance: 20.0   # é»˜è®¤100.0 â†’ 20.0m
          object_check_backward_distance: 10.0  # é»˜è®¤100.0 â†’ 10.0m
          ignore_object_velocity_threshold: 0.5  # é»˜è®¤1.0 â†’ 0.5 m/s
          
          # å®¤å†…AGVä¸»è¦å…³å¿ƒäºº
          object_types_to_check:
            check_car: false              # AGVé€šå¸¸ä¸ä¸è½¦å…±å­˜
            check_truck: false
            check_bus: false
            check_trailer: false
            check_bicycle: true           # å¯èƒ½æœ‰
            check_motorcycle: false
            check_pedestrian: true        # âœ“ é‡è¦
            check_unknown: true           # âœ“ ä¿å®ˆç­–ç•¥
        
        safety_check_params:
          enable_safety_check: true
          method: "integral_predicted_polygon"
          keep_unsafe_time: 0.3             # é»˜è®¤0.5 â†’ 0.3s
          
          rss_params:
            rear_vehicle_reaction_time: 1.0     # é»˜è®¤2.0 â†’ 1.0s
            rear_vehicle_safety_time_margin: 0.5  # é»˜è®¤1.0 â†’ 0.5s
            lateral_distance_max_threshold: 1.0   # é»˜è®¤2.0 â†’ 1.0m
            longitudinal_distance_min_threshold: 1.0  # é»˜è®¤3.0 â†’ 1.0m
          
          integral_predicted_polygon_params:
            forward_margin: 0.5             # é»˜è®¤1.0 â†’ 0.5m
            backward_margin: 0.3            # é»˜è®¤1.0 â†’ 0.3m
            lat_margin: 0.3                 # é»˜è®¤1.0 â†’ 0.3m
            time_horizon: 3.0               # é»˜è®¤5.0 â†’ 3.0s
          
          backward_path_length: 10.0        # é»˜è®¤30.0 â†’ 10.0m
          forward_path_length: 20.0         # é»˜è®¤100.0 â†’ 20.0m
```

---

### 3. å…¶ä»–Scene Modulesé…ç½®ï¼ˆå¯é€‰ç¦ç”¨ï¼‰

**æ–‡ä»¶ï¼š** `scene_module_manager.param.yaml`

```yaml
/**:
  ros__parameters:
    # ========== Sloté…ç½® ==========
    # å®¤å†…AGVç®€åŒ–Slotç»“æ„
    slots:
      - slot1  # start
      - slot2  # goal
    
    # Slot 1: Start Plannerï¼ˆå¦‚æœéœ€è¦ï¼‰
    slot1:
      - "start_planner"
    
    # Slot 2: Goal Plannerï¼ˆæ ¸å¿ƒï¼‰
    slot2:
      - "goal_planner"
    
    # ç¦ç”¨ä¸éœ€è¦çš„æ¨¡å—ï¼ˆæ³¨é‡Šæ‰æˆ–ç§»é™¤ï¼‰
    # - "static_obstacle_avoidance"  # å¯èƒ½ä¸éœ€è¦
    # - "lane_change_left"           # å®¤å†…AGVé€šå¸¸ä¸æ¢é“
    # - "lane_change_right"
    # - "avoidance_by_lane_change"
    # - "side_shift"
    # - "dynamic_obstacle_avoidance"
    
    # ========== æ¨¡å—ä½¿èƒ½é…ç½® ==========
    start_planner:
      enable_module: true
      enable_simultaneous_execution_as_approved_module: false
      enable_simultaneous_execution_as_candidate_module: false
      priority: 0
      max_module_size: 1
    
    goal_planner:
      enable_module: true
      enable_simultaneous_execution_as_approved_module: false
      enable_simultaneous_execution_as_candidate_module: false
      enable_rtc: false  # AGVè‡ªåŠ¨æ‰§è¡Œï¼Œä¸éœ€è¦äººå·¥æ‰¹å‡†
      priority: 0
      max_module_size: 1
```

**æ–‡ä»¶ï¼š** `default_preset.yaml`

```yaml
# ç¦ç”¨ä¸éœ€è¦çš„æ¨¡å—
launch:
  # å®¤å†…AGVé€šå¸¸ä¸éœ€è¦è¿™äº›
  - arg:
      name: launch_static_obstacle_avoidance
      default: "false"  # ç¦ç”¨
  - arg:
      name: launch_dynamic_obstacle_avoidance_module
      default: "false"  # ç¦ç”¨
  - arg:
      name: launch_lane_change_left
      default: "false"  # ç¦ç”¨
  - arg:
      name: launch_lane_change_right
      default: "false"  # ç¦ç”¨
  - arg:
      name: launch_avoidance_by_lane_change
      default: "false"  # ç¦ç”¨
  
  # ä¿ç•™å¿…è¦æ¨¡å—
  - arg:
      name: launch_goal_planner_module
      default: "true"   # å¯ç”¨
  - arg:
      name: launch_start_planner_module
      default: "true"   # å¯ç”¨ï¼ˆå¦‚æœéœ€è¦ï¼‰
```

---

### 4. Start Planner é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰

**æ–‡ä»¶ï¼š** `start_planner.param.yaml`

```yaml
/**:
  ros__parameters:
    start_planner:
      th_arrived_distance: 0.3        # é»˜è®¤1.0 â†’ 0.3m
      th_stopped_velocity: 0.01
      th_stopped_time: 1.0            # é»˜è®¤2.0 â†’ 1.0s
      
      # AGVèµ·æ­¥é…ç½®
      prepare_time_before_start: 1.0  # é»˜è®¤ä¸å˜
      th_distance_to_middle_of_the_road: 0.3  # é»˜è®¤0.5 â†’ 0.3m
      
      # ç®€åŒ–collision checkï¼ˆå®¤å†…ç¯å¢ƒç›¸å¯¹å¯æ§ï¼‰
      collision_check_margins: [1.0, 0.5]  # ç®€åŒ–margin
      collision_check_distance_from_end: 5.0  # é»˜è®¤ä¸å˜æˆ–æ›´å°
      
      th_moving_object_velocity: 0.5  # é»˜è®¤1.0 â†’ 0.5 m/s
```

---

### 5. è½¦è¾†å‚æ•°é…ç½®

**æ–‡ä»¶ï¼š** `vehicle_info.param.yaml`

```yaml
/**:
  ros__parameters:
    # ========== AGVç‰©ç†å°ºå¯¸ ==========
    # âš ï¸ æ ¹æ®å®é™…AGVå°ºå¯¸ä¿®æ”¹
    wheel_radius: 0.1                # è½¦è½®åŠå¾„ [m]
    wheel_width: 0.08                # è½¦è½®å®½åº¦ [m]
    wheel_base: 0.8                  # è½´è· [m]ï¼ˆå‰åè½®è·ç¦»ï¼‰
    wheel_tread: 0.6                 # è½®è· [m]ï¼ˆå·¦å³è½®è·ç¦»ï¼‰
    front_overhang: 0.2              # å‰æ‚¬ [m]
    rear_overhang: 0.2               # åæ‚¬ [m]
    left_overhang: 0.1               # å·¦æ‚¬ [m]
    right_overhang: 0.1              # å³æ‚¬ [m]
    vehicle_height: 1.0              # è½¦é«˜ [m]
    
    # è®¡ç®—å¾—å‡ºï¼š
    # vehicle_length = wheel_base + front_overhang + rear_overhang = 1.2m
    # vehicle_width = wheel_tread + left_overhang + right_overhang = 0.8m
    
    # ========== å®‰å…¨è£•åº¦ ==========
    max_steer_angle: 0.7             # æœ€å¤§è½¬å‘è§’ [rad]ï¼ˆçº¦40åº¦ï¼‰
```

---

## ğŸ“Š é…ç½®å¯¹æ¯”è¡¨

### å…³é”®å‚æ•°å¯¹æ¯”

| å‚æ•° | å®¤å¤–è½¦è¾† | å®¤å†…AGV | å˜åŒ– |
|-----|---------|---------|------|
| **è·¯å¾„é•¿åº¦** |
| forward_path_length | 300.0 m | 30.0 m | â¬‡ï¸ 90% |
| backward_path_length | 5.0 m | 2.0 m | â¬‡ï¸ 60% |
| **ç›®æ ‡æœç´¢** |
| forward_goal_search | 40.0 m | 10.0 m | â¬‡ï¸ 75% |
| backward_goal_search | 20.0 m | 5.0 m | â¬‡ï¸ 75% |
| goal_search_interval | 2.0 m | 0.5 m | â¬‡ï¸ 75% |
| **åˆ°è¾¾ç²¾åº¦** |
| th_arrived_distance | 1.0 m | 0.3 m | â¬†ï¸ ç²¾åº¦æé«˜ |
| **é€Ÿåº¦** |
| pull_over_velocity | 3.0 m/s | 0.8 m/s | â¬‡ï¸ 73% |
| pull_over_min_velocity | 1.38 m/s | 0.5 m/s | â¬‡ï¸ 64% |
| **åŠ¨åŠ›å­¦** |
| maximum_deceleration | 1.0 m/sÂ² | 0.5 m/sÂ² | â¬‡ï¸ 50% |
| maximum_jerk | 1.0 m/sÂ³ | 0.5 m/sÂ³ | â¬‡ï¸ 50% |
| **è·ç¦»é˜ˆå€¼** |
| minimum_request_length | 0.0 m | 5.0 m | âš ï¸ å¿…é¡»è®¾ç½® |
| decide_path_distance | 10.0 m | 3.0 m | â¬‡ï¸ 70% |
| pull_over_prepare_length | 100.0 m | 15.0 m | â¬‡ï¸ 85% |

---

## ğŸ”§ å®é™…ä½¿ç”¨å»ºè®®

### 1. è®¾ç½®ç›®æ ‡ç‚¹æ—¶çš„æ³¨æ„äº‹é¡¹

```bash
# âŒ é”™è¯¯ï¼šç›®æ ‡ç‚¹å¤ªè¿‘
è·ç¦»èµ·ç‚¹ï¼š3m
å½“å‰é€Ÿåº¦ï¼š2 m/s
â†’ æ— æ³•ç”Ÿæˆæœ‰æ•ˆè·¯å¾„ï¼

# âœ… æ­£ç¡®ï¼šå®¤å†…AGV
è·ç¦»èµ·ç‚¹ï¼šâ‰¥ 5mï¼ˆé™æ­¢çŠ¶æ€ï¼‰
è·ç¦»èµ·ç‚¹ï¼šâ‰¥ 10mï¼ˆç§»åŠ¨çŠ¶æ€ï¼Œ2 m/sï¼‰
å½“å‰é€Ÿåº¦ï¼š< 2 m/s
â†’ å¯ä»¥æ­£å¸¸è§„åˆ’

# âœ… æ­£ç¡®ï¼šå®¤å¤–è½¦è¾†
è·ç¦»èµ·ç‚¹ï¼šâ‰¥ 15mï¼ˆä½é€Ÿï¼‰
è·ç¦»èµ·ç‚¹ï¼šâ‰¥ 30mï¼ˆä¸­é€Ÿï¼‰
è·ç¦»èµ·ç‚¹ï¼šâ‰¥ 50mï¼ˆé«˜é€Ÿï¼‰
```

### 2. åŠ¨æ€è°ƒæ•´ç­–ç•¥

æ ¹æ®å½“å‰é€Ÿåº¦åŠ¨æ€è®¡ç®—æœ€å°ç›®æ ‡è·ç¦»ï¼š

```python
# ä¼ªä»£ç ï¼šè®¡ç®—æœ€å°å®‰å…¨è·ç¦»
def calculate_min_goal_distance(current_velocity, max_decel, max_jerk):
    """
    è®¡ç®—åˆ°è¾¾ç›®æ ‡ç‚¹çš„æœ€å°å®‰å…¨è·ç¦»
    """
    # è€ƒè™‘å‡é€Ÿè·ç¦»
    t_jerk = current_velocity / max_jerk  # åŠ åŠ é€Ÿåº¦æ—¶é—´
    t_decel = current_velocity / max_decel  # å‡é€Ÿæ—¶é—´
    
    # ä¸¤é˜¶æ®µå‡é€Ÿè·ç¦»
    d_jerk = 0.5 * max_jerk * t_jerk**2  # åŠ åŠ é€Ÿåº¦é˜¶æ®µ
    d_decel = current_velocity * t_decel - 0.5 * max_decel * t_decel**2  # åŒ€å‡é€Ÿé˜¶æ®µ
    
    # æ€»è·ç¦» + å®‰å…¨è£•åº¦
    min_distance = d_jerk + d_decel + safety_margin
    
    return min_distance

# ç¤ºä¾‹è®¡ç®—
# AGV: v=2m/s, a=0.5m/sÂ², j=0.5m/sÂ³, margin=2m
min_dist_agv = calculate_min_goal_distance(2.0, 0.5, 0.5)
# â†’ çº¦ 6-8m

# å®¤å¤–è½¦è¾†: v=10m/s, a=1.0m/sÂ², j=1.0m/sÂ³, margin=5m
min_dist_vehicle = calculate_min_goal_distance(10.0, 1.0, 1.0)
# â†’ çº¦ 55-60m
```

### 3. è·¯å¾„é•¿åº¦é€‰æ‹©æŒ‡å—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨åœºæ™¯              â”‚ forward_path_length            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®¤å†…AGVï¼ˆå°æˆ¿é—´ï¼‰     â”‚ 10-20 m                        â”‚
â”‚ å®¤å†…AGVï¼ˆå¤§ä»“åº“ï¼‰     â”‚ 20-50 m                        â”‚
â”‚ å®¤å¤–ä½é€Ÿè½¦è¾†          â”‚ 50-100 m                       â”‚
â”‚ å®¤å¤–æ­£å¸¸è½¦è¾†          â”‚ 100-300 m                      â”‚
â”‚ é«˜é€Ÿå…¬è·¯              â”‚ 300-500 m                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åŸåˆ™ï¼š
  forward_path_length â‰¥ 2 Ã— æœ€å¤§ç›®æ ‡è·ç¦»
  forward_path_length â‰¥ 10 Ã— å½“å‰é€Ÿåº¦ï¼ˆç§’ï¼‰
```

---

## ğŸš€ å¿«é€Ÿé…ç½®è„šæœ¬

### AGVé…ç½®æ£€æŸ¥è„šæœ¬

```bash
#!/bin/bash
# check_agv_config.sh - æ£€æŸ¥AGVé…ç½®æ˜¯å¦åˆç†

echo "=== AGVé…ç½®æ£€æŸ¥ ==="

# æ£€æŸ¥è·¯å¾„é•¿åº¦
forward_path=$(rosparam get /planning/scenario_planning/lane_driving/behavior_planning/behavior_path_planner/forward_path_length)
echo "[1] forward_path_length: $forward_path m"
if (( $(echo "$forward_path > 50" | bc -l) )); then
  echo "  âš ï¸  è­¦å‘Šï¼šå¯¹äºAGVæ¥è¯´å¯èƒ½å¤ªé•¿ï¼Œå»ºè®®20-30m"
fi

# æ£€æŸ¥minimum_request_length
min_req=$(rosparam get /planning/.../goal_planner/pull_over/minimum_request_length)
echo "[2] minimum_request_length: $min_req m"
if (( $(echo "$min_req < 3" | bc -l) )); then
  echo "  âŒ é”™è¯¯ï¼šå¤ªçŸ­ï¼å»ºè®®è®¾ç½®ä¸º5-10m"
fi

# æ£€æŸ¥åˆ°è¾¾è·ç¦»
arrived_dist=$(rosparam get /planning/.../goal_planner/th_arrived_distance)
echo "[3] th_arrived_distance: $arrived_dist m"
if (( $(echo "$arrived_dist > 0.5" | bc -l) )); then
  echo "  âš ï¸  è­¦å‘Šï¼šå¯¹äºAGVç²¾åº¦å¯èƒ½ä¸å¤Ÿï¼Œå»ºè®®0.2-0.3m"
fi

# æ£€æŸ¥pull overé€Ÿåº¦
po_vel=$(rosparam get /planning/.../goal_planner/pull_over/pull_over_velocity)
echo "[4] pull_over_velocity: $po_vel m/s"
if (( $(echo "$po_vel > 1.5" | bc -l) )); then
  echo "  âš ï¸  è­¦å‘Šï¼šå¯¹äºAGVå¯èƒ½å¤ªå¿«ï¼Œå»ºè®®0.5-1.0 m/s"
fi

echo ""
echo "=== æ£€æŸ¥å®Œæˆ ==="
```

---

## ğŸ“– æ€»ç»“

### é—®é¢˜å›ç­”

#### Q1: ç›®æ ‡ç‚¹è·ç¦»èµ·ç‚¹è¾ƒè¿‘æœ‰å½±å“å—ï¼Ÿ
**A:** **æœ‰æ˜¾è‘—å½±å“ï¼**
- è·ç¦» < å‡é€Ÿæ‰€éœ€æœ€å°è·ç¦» â†’ è·¯å¾„è§„åˆ’å¤±è´¥
- è·ç¦» < `minimum_request_length` â†’ Goal Plannerä¸æ‰§è¡Œ
- è·ç¦» < `decide_path_distance/2` (é™æ­¢æ—¶) â†’ æ— æ³•é‡å¯

#### Q2: ä¼šå¯¼è‡´é€Ÿåº¦ä¸º0å—ï¼Ÿ
**A:** **ä¼šï¼**
- ç›®æ ‡ç‚¹æœ¬èº«é€Ÿåº¦å¼ºåˆ¶ä¸º0
- ç›®æ ‡ç‚¹é™„è¿‘åŒºåŸŸå¤„äºå‡é€Ÿé˜¶æ®µ
- å¦‚æœè·ç¦»å¤ªçŸ­ï¼Œæ•´ä¸ªè·¯å¾„éƒ½æ˜¯å‡é€ŸåŒº
- æ— æœ‰æ•ˆè½¦é“æ—¶ï¼Œå¯èƒ½ç”Ÿæˆå…¨é›¶é€Ÿåº¦è·¯å¾„

#### Q3: å®¤å†…AGVå¦‚ä½•é…ç½®ï¼Ÿ
**A:** **å…³é”®è°ƒæ•´ï¼š**
1. **ç¼©çŸ­è·¯å¾„é•¿åº¦**ï¼š300m â†’ 30m
2. **æé«˜åˆ°è¾¾ç²¾åº¦**ï¼š1.0m â†’ 0.3m
3. **é™ä½é€Ÿåº¦**ï¼š3.0m/s â†’ 0.8m/s
4. **å‡å°åŠ¨åŠ›å­¦å‚æ•°**ï¼š1.0m/sÂ² â†’ 0.5m/sÂ²
5. **è®¾ç½®æœ€å°è·ç¦»**ï¼š0m â†’ 5m
6. **ç¦ç”¨ä¸éœ€è¦çš„æ¨¡å—**ï¼šæ¢é“ã€é¿éšœç­‰
7. **è°ƒæ•´å®‰å…¨margin**ï¼šå¤§å¹…å‡å°

### æœ€ä½³å®è·µ

```
âœ… DO:
  - è®¾ç½®ç›®æ ‡ç‚¹æ—¶æ£€æŸ¥å½“å‰é€Ÿåº¦
  - ç¡®ä¿è·ç¦» â‰¥ 2 Ã— å‡é€Ÿè·ç¦»
  - ä¸ºAGVä½¿ç”¨ä¸“é—¨é…ç½®
  - æµ‹è¯•æœ€å°å¯è¡Œè·ç¦»
  - ç›‘æ§è·¯å¾„è§„åˆ’å¤±è´¥ç‡

âŒ DON'T:
  - ä½¿ç”¨é»˜è®¤é…ç½®äºAGV
  - è®¾ç½®è¿‡è¿‘çš„ç›®æ ‡ç‚¹ï¼ˆ< 5mï¼‰
  - å¿½ç•¥ minimum_request_length
  - ä½¿ç”¨è¿‡å¤§çš„ forward_path_length
  - å¯ç”¨ä¸éœ€è¦çš„scene modules
```

---

**ç›¸å…³æ–‡æ¡£ï¼š**
- [behavior_path_planneråœºæ™¯æ¨¡å—å·¥ä½œåŸç†è¯¦è§£.md](./behavior_path_planneråœºæ™¯æ¨¡å—å·¥ä½œåŸç†è¯¦è§£.md)
- [behavior_path_planneré€Ÿåº¦ä¸ºé›¶çš„åŸå› åˆ†æ.md](./behavior_path_planneré€Ÿåº¦ä¸ºé›¶çš„åŸå› åˆ†æ.md)
- [VEHICLE_INFO_CONFIG_EXPLANATION.md](./VEHICLE_INFO_CONFIG_EXPLANATION.md)

